{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\MSI GF63\\\\Desktop\\\\ShoppingWeb\\\\frontend\\\\src\\\\component\\\\pages\\\\Home.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport ProductList from \"../common/ProductList\";\nimport Pagination from \"../common/Pagination\";\nimport ApiService from \"../../service/ApiService\";\nimport '../../style/home.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst itemsPerPage = 10;\nconst getInitialSmartSearch = location => {\n  var _location$state;\n  // Ưu tiên lấy từ location.state, nếu không thì lấy từ localStorage\n  if ((_location$state = location.state) !== null && _location$state !== void 0 && _location$state.searchResult) return location.state.searchResult;\n  const last = localStorage.getItem('lastSmartSearch');\n  if (last) {\n    try {\n      return JSON.parse(last).searchResult;\n    } catch {}\n  }\n  return null;\n};\nconst Home = () => {\n  _s();\n  const location = useLocation();\n  const [products, setProducts] = useState([]);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [totalPages, setTotalPages] = useState(0);\n  const [error, setError] = useState(null);\n  const [searchResult, setSearchResult] = useState(() => getInitialSmartSearch(location));\n\n  // Khi bấm Home, location.state sẽ mất, cần xóa smart search khỏi localStorage và state\n  useEffect(() => {\n    var _location$state2;\n    if (!((_location$state2 = location.state) !== null && _location$state2 !== void 0 && _location$state2.searchResult)) {\n      localStorage.removeItem('lastSmartSearch');\n      setSearchResult(null);\n    }\n  }, [location.state]);\n\n  // Nếu có smart search, ưu tiên hiển thị kết quả này\n  useEffect(() => {\n    if (searchResult) {\n      var _searchResult$product;\n      setProducts(searchResult.products || []);\n      setTotalPages(Math.ceil((((_searchResult$product = searchResult.products) === null || _searchResult$product === void 0 ? void 0 : _searchResult$product.length) || 0) / itemsPerPage));\n      setError(null);\n      setCurrentPage(1);\n    }\n  }, [searchResult]);\n\n  // Nếu không có smart search, fetch sản phẩm mặc định\n  useEffect(() => {\n    if (searchResult) return; // Đã xử lý ở useEffect trên\n\n    const fetchProducts = async () => {\n      try {\n        let allProducts = [];\n        const queryparams = new URLSearchParams(location.search);\n        const searchItem = queryparams.get('search');\n        if (searchItem) {\n          const response = await ApiService.searchProducts(searchItem);\n          allProducts = response.productList || [];\n        } else {\n          const response = await ApiService.getAllProducts();\n          allProducts = response || [];\n        }\n        setTotalPages(Math.ceil(allProducts.length / itemsPerPage));\n        setProducts(allProducts.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage));\n        setError(null);\n      } catch (error) {\n        var _error$response, _error$response$data;\n        setError(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || 'unable to fetch products');\n      }\n    };\n    fetchProducts();\n  }, [location.search, currentPage, searchResult]);\n\n  // Lấy sản phẩm trang hiện tại nếu là smart search\n  const paginatedProducts = searchResult ? (searchResult.products || []).slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage) : products;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home\",\n    children: error ? /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 17\n    }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [searchResult && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"search-results\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"search-explanation\",\n          children: searchResult.explanation\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 29\n        }, this), paginatedProducts.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"no-results\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: searchResult.explanation\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"G\\u1EE3i \\xFD: H\\xE3y nh\\u1EADp t\\u1EEB kh\\xF3a c\\u1EE5 th\\u1EC3 h\\u01A1n, v\\xED d\\u1EE5: \\\"\\u0111i\\u1EC7n tho\\u1EA1i Samsung d\\u01B0\\u1EDBi 10 tri\\u1EC7u c\\xF2n h\\xE0ng\\\"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 37\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 33\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 25\n      }, this), !searchResult && paginatedProducts.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"no-results\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Kh\\xF4ng c\\xF3 s\\u1EA3n ph\\u1EA9m n\\xE0o \\u0111\\u1EC3 hi\\u1EC3n th\\u1ECB.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 25\n      }, this), /*#__PURE__*/_jsxDEV(ProductList, {\n        products: paginatedProducts\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Pagination, {\n        currentPage: currentPage,\n        totalPages: totalPages,\n        onPageChange: page => setCurrentPage(page)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 9\n  }, this);\n};\n_s(Home, \"sia7OxxgSSsJ030Kd5y45BAR4vw=\", false, function () {\n  return [useLocation];\n});\n_c = Home;\nexport default Home;\nvar _c;\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"names":["React","useEffect","useState","useLocation","ProductList","Pagination","ApiService","jsxDEV","_jsxDEV","itemsPerPage","getInitialSmartSearch","location","_location$state","state","searchResult","last","localStorage","getItem","JSON","parse","Home","_s","products","setProducts","currentPage","setCurrentPage","totalPages","setTotalPages","error","setError","setSearchResult","_location$state2","removeItem","_searchResult$product","Math","ceil","length","fetchProducts","allProducts","queryparams","URLSearchParams","search","searchItem","get","response","searchProducts","productList","getAllProducts","slice","_error$response","_error$response$data","data","message","paginatedProducts","className","children","fileName","_jsxFileName","lineNumber","columnNumber","explanation","onPageChange","page","_c","$RefreshReg$"],"sources":["C:/Users/MSI GF63/Desktop/ShoppingWeb/frontend/src/component/pages/Home.jsx"],"sourcesContent":["import React, {useEffect, useState} from \"react\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport ProductList from \"../common/ProductList\";\r\nimport Pagination from \"../common/Pagination\";\r\nimport ApiService from \"../../service/ApiService\";\r\nimport '../../style/home.css';\r\n\r\nconst itemsPerPage = 10;\r\n\r\nconst getInitialSmartSearch = (location) => {\r\n    // Ưu tiên lấy từ location.state, nếu không thì lấy từ localStorage\r\n    if (location.state?.searchResult) return location.state.searchResult;\r\n    const last = localStorage.getItem('lastSmartSearch');\r\n    if (last) {\r\n        try {\r\n            return JSON.parse(last).searchResult;\r\n        } catch {}\r\n    }\r\n    return null;\r\n};\r\n\r\nconst Home = () => {\r\n    const location = useLocation();\r\n    const [products, setProducts] = useState([]);\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [totalPages, setTotalPages] = useState(0);\r\n    const [error, setError] = useState(null);\r\n    const [searchResult, setSearchResult] = useState(() => getInitialSmartSearch(location));\r\n\r\n    // Khi bấm Home, location.state sẽ mất, cần xóa smart search khỏi localStorage và state\r\n    useEffect(() => {\r\n        if (!location.state?.searchResult) {\r\n            localStorage.removeItem('lastSmartSearch');\r\n            setSearchResult(null);\r\n        }\r\n    }, [location.state]);\r\n\r\n    // Nếu có smart search, ưu tiên hiển thị kết quả này\r\n    useEffect(() => {\r\n        if (searchResult) {\r\n            setProducts(searchResult.products || []);\r\n            setTotalPages(Math.ceil((searchResult.products?.length || 0) / itemsPerPage));\r\n            setError(null);\r\n            setCurrentPage(1);\r\n        }\r\n    }, [searchResult]);\r\n\r\n    // Nếu không có smart search, fetch sản phẩm mặc định\r\n    useEffect(() => {\r\n        if (searchResult) return; // Đã xử lý ở useEffect trên\r\n\r\n        const fetchProducts = async () => {\r\n            try{\r\n                let allProducts = [];\r\n                const queryparams = new URLSearchParams(location.search);\r\n                const searchItem = queryparams.get('search')\r\n\r\n                if (searchItem) {\r\n                    const response = await ApiService.searchProducts(searchItem);\r\n                    allProducts = response.productList || [];\r\n                } else {\r\n                    const response = await ApiService.getAllProducts();\r\n                    allProducts = response || [];\r\n                }\r\n\r\n                setTotalPages(Math.ceil(allProducts.length/itemsPerPage));\r\n                setProducts(allProducts.slice((currentPage -1) * itemsPerPage, currentPage * itemsPerPage));\r\n                setError(null);\r\n            } catch(error){\r\n                setError(error.response?.data?.message || error.message || 'unable to fetch products')\r\n            }\r\n        }\r\n\r\n        fetchProducts();\r\n    }, [location.search, currentPage, searchResult]);\r\n\r\n    // Lấy sản phẩm trang hiện tại nếu là smart search\r\n    const paginatedProducts = searchResult\r\n        ? (searchResult.products || []).slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage)\r\n        : products;\r\n\r\n    return(\r\n        <div className=\"home\">\r\n            {error ? (\r\n                <p className=\"error-message\">{error}</p>\r\n            ):(\r\n                <div>\r\n                    {/* Nếu có smart search, hiển thị giải thích và kết quả */}\r\n                    {searchResult && (\r\n                        <div className=\"search-results\">\r\n                            <div className=\"search-explanation\">\r\n                                {searchResult.explanation}\r\n                            </div>\r\n                            {paginatedProducts.length === 0 && (\r\n                                <div className=\"no-results\">\r\n                                    <p>{searchResult.explanation}</p>\r\n                                    <p>Gợi ý: Hãy nhập từ khóa cụ thể hơn, ví dụ: \"điện thoại Samsung dưới 10 triệu còn hàng\"</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                    {/* Nếu không có sản phẩm, báo lên giao diện */}\r\n                    {!searchResult && paginatedProducts.length === 0 && (\r\n                        <div className=\"no-results\">\r\n                            <p>Không có sản phẩm nào để hiển thị.</p>\r\n                        </div>\r\n                    )}\r\n                    <ProductList products={paginatedProducts}/>\r\n                    <Pagination  \r\n                        currentPage={currentPage}\r\n                        totalPages={totalPages}\r\n                        onPageChange={(page)=> setCurrentPage(page)}\r\n                    />\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Home;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}